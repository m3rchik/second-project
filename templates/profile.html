<!DOCTYPE html>
<html lang="ru" data-theme="{{ theme }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль - {{ user.nickname }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="article-header">
        <div class="article-nav">
            <a href="{{ url_for('news') }}" class="back-button">
                <i class="fas fa-arrow-left"></i> Вернуться к новостям
            </a>
            <button class="theme-toggle" type="button" aria-label="Переключить тему">
                <i class="fas {% if theme == 'dark' %}fa-sun{% else %}fa-moon{% endif %}"></i>
            </button>
        </div>
    </div>

    <div class="container">
        <div class="profile-info">
            <div class="profile-header">
                <div class="avatar-large">
                    <img src="{{ url_for('static', filename='uploads/avatars/' + (profile.avatar_path if profile and profile.avatar_path else 'default-avatar.png')) }}" alt="Аватар пользователя">
                </div>
                <div class="profile-details">
                    <h1>{{ user.nickname }}</h1>
                    <p class="email">{{ user.email }}</p>
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-value">{{ favorites|length if favorites else 0 }}</span>
                            <span class="stat-label">ИЗБРАННЫХ</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">{{ view_history|length if view_history else 0 }}</span>
                            <span class="stat-label">ПРОСМОТРЕНО</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">{{ user.registration_date.strftime('%d.%m.%Y') }}</span>
                            <span class="stat-label">ДАТА РЕГИСТРАЦИИ</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-sections">
                <div class="section">
                    <h2><i class="fas fa-tags"></i> Предпочитаемые категории</h2>
                    <div class="categories-grid">
                        {% for category in profile.preferred_categories if profile %}
                            <div class="category-tag">{{ category }}</div>
                        {% else %}
                            <p>Категории не выбраны</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="section">
                    <h2><i class="fas fa-star"></i> Избранные статьи</h2>
                    <div class="articles-grid">
                        {% for article in favorites if favorites %}
                            <div class="article-card">
                                <a href="{{ url_for('article', article_url=article.article_url) }}" class="article-link">
                                    <h3>{{ article.article_title }}</h3>
                                    <div class="article-meta">
                                        <span>{{ article.added_at.strftime('%d.%m.%Y') }}</span>
                                    </div>
                                </a>
                            </div>
                        {% else %}
                            <p>Нет избранных статей</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="section">
                    <h2><i class="fas fa-history"></i> История просмотров</h2>
                    <div class="articles-grid">
                        {% for view in view_history if view_history %}
                            <div class="article-card">
                                <a href="{{ url_for('article', article_url=view.article_url) }}" class="article-link">
                                    <h3>{{ view.article_title }}</h3>
                                    <div class="article-meta">
                                        <span>{{ view.viewed_at.strftime('%d.%m.%Y %H:%M') }}</span>
                                    </div>
                                </a>
                            </div>
                        {% else %}
                            <p>История просмотров пуста</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Обработка темы
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            const themeToggle = document.querySelector('.theme-toggle i');
            if (themeToggle) {
                themeToggle.className = `fas ${theme === 'dark' ? 'fa-sun' : 'fa-moon'}`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);

            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    setTheme(newTheme);
                    
                    fetch('/update_theme', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `theme=${newTheme}`
                    });
                });
            }
        });
    </script>
</body>
</html> 